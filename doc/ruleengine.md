因为每一个买卖的条件都可以看成是一个规则,因此用一个"规则引擎"来进行代码划分和规划更加的清晰合理。以下是一个样例。

买入规则:

* 当 满足条件
  10日均线拐头向上, 收阳线, 收盘价站上10日均线, ma10 > ma20 时

  动作:
    买入4成仓位

* 当首次买入的仓位盈利5%时,且diff > 0, 加4成仓位

* 当第二次加的仓位继续盈利5%时且diff > 0,加最后两成仓位


卖出规则:

* 当 满足条件
    10日均线拐头向下,收阴线, 收盘价低于10日均线3%的幅度
  动作: 卖出已有仓位的一半

* 当 diff < 0, 卖出全部仓位
* 当 出现 乌云盖顶的k线形态(或是其它大概率的见顶形态),清仓。



技术实现

1. 需要一个规则引擎。这个引擎不需要非常复杂, 主要的用途不是为了给商业专家使用,而是为了在架构上使得代码更清晰,
并且具有一定的定制功能。

初步选定 easyrules + jolokia。

easyrules是一个很简单的规则引擎, 通过@Condition/@Action来分离条件和动作。并提供JMX运行时修改参数的功能。
jolokia允许通过HTTP服务通过JMX修改bean的状态。不过为什么不能将这些参数持久化到数据库??


开发计划:

1. 将代码迁移到easyrules实现,规则的动作结果输出到日志
2. 实现规则结果输出到管道,让监听者自行决定行为。例如,一个买入信号对于一个监听者可能会加仓,另外一个可能是建仓。
3. 短信通知功能,发送邮件功能
4. 定期运行功能


参考资料:

http://www.easyrules.org
https://jolokia.org
http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-jmx.html